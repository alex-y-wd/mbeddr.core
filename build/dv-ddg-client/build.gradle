/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */


 /*
 * Do not modify!
 */



apply from: 'build/dv-ddg-client/ddgconfig.gradle'



def java_args_config = {

  main = 'DepDataGen.build.util.ddg.cmd_tool.cmd_tool.DdgPipeRunner'

  //provide the paths to your projects here as java-args
  if(remote){
      args '---r'
      args "${url}"
  }
  else{
      args '---l'
  }

  // not applicable with mps-19-1
  //args '---a-p-u'
  //args "${plugins_location}"
  //end not applicable

  ddg_use_cases.each { use_case ->
      args "${use_case}"
  }

  //class path for ddg
  classpath file('./build/dv-ddg-client/ddg-pipe.jar')
  classpath file('./build/dv-ddg-client/gc-client.jar')
  classpath file('./build/dv-ddg-client/ddg.jar')
  classpath fileTree('./build/dv-ddg-client/dm.client.lib/')

  //mps-specific class path
  classpath file('./build/dv-ddg-client/jdi.jar')

  classpath fileTree("${mps_home}/lib") // $mps_home points to the MPS installation
  classpath fileTree("${mps_home}/plugins")
}

// ####################### mbeddr ################

task run_ddg_all_mbeddr(){
    if(project.ext.ciBuild && ddgEnabled){
        urlTemp = remote? url : "localhost"
        println "ddg is executed. Sending to url: " + urlTemp
        dependsOn {
            tasks.findAll {task -> task.name.startsWith('run_mbeddr_')}
        }
    }else{
        println "run_ddg: ciBuild: " + project.ext.ciBuild
        if(project.ext.ciBuild){
            println "run_ddg: ddgEnabled: " + ddgEnabled
        }
        println "run_ddg: SKIPPED"
    }
}

task run_mbeddr_analyses(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.analyses"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}


task run_mbeddr_build(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.build"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}


task run_mbeddr_cc(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.cc"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}


task run_mbeddr_core(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.core"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"

    args '---a-p-u'
    args "${application_support_plugins_location}"
}


task run_mbeddr_debugger(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.debugger"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

//fails
task run_mbeddr_debugger_tests(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.debugger.tests"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_mbeddr_doc(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.doc"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_mbeddr_doc_aspect(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.doc.aspect"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_mbeddr_ext(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.ext"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_mbeddr_mpsutil(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.mpsutil"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_mbeddr_rcp(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.rcp"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_mbeddr_spawner(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.spawner"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_mbeddr_xmodel(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "./code/languages/com.mbeddr.xmodel"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

// #################
// ################# applications #################

/*
task run_appl_mbeddr_buildExamples(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "${projects_home}/mbeddr.core/code/applications/com.mbeddr.build-examples"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_appl_mbeddr_documentation(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "${projects_home}/mbeddr.core/code/applications/com.mbeddr.documentation"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_appl_mbeddr_embedded(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "${projects_home}/mbeddr.core/code/applications/com.mbeddr.embedded"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_appl_heartBleed(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "${projects_home}/mbeddr.core/code/applications/HeartBleed"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_appl_integratedCExample(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "${projects_home}/mbeddr.core/code/applications/IntegratedCExample"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_appl_pacemaker(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "${projects_home}/mbeddr.core/code/applications/Pacemaker"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_appl_tutorial(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "${projects_home}/mbeddr.core/code/applications/tutorial"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

task run_appl_tutorialDslsExtension(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core'

    args '---f'
    args "${projects_home}/mbeddr.core/code/applications/tutorial-dsls-extensions"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}

// ############
// ############ tools #############

task run_tools_mbeddr_eclipseDebugger(type: JavaExec) {

    configure java_args_config

    args '---vp'
    args 'mbeddr.core.tools'

    args '---f'
    args "${projects_home}/mbeddr.core/tools/Eclipse.Debugger"

    args '---macro'
    args "${mgch}"
    args "${mgch_path}"
}
*/

//DependenciesViewer

task build_mbeddrBeforeDdg {
    println "task build_mbeddr"
    dependsOn 'build:com.mbeddr:languages:build_mbeddr'
}

run_ddg_all_mbeddr.dependsOn build_mbeddrBeforeDdg

task buildWithDdg {
    println 'ddg'
    dependsOn run_ddg_all_mbeddr
}
//End DependenciesViewer
